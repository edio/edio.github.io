<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="UTF-8">
  <title>
    randrctl — profile-based screen manager for X | 127.0.0.1
  </title>

  
  <meta name="viewport" content="width=device-width,user-scalable=yes,maximum-scale=1.5,initial-scale=1">

  
  <link rel="canonical" href="http://127001.me/post/introducing-randrctl/"/>

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon144.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  <link rel="stylesheet" href="/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/hljs/atelier-heath-light.css">
  <link rel="stylesheet" href="/css/theme.css">

  
  <link href="http://127001.me/index.xml" rel="alternate" type="application/rss+xml" title="127.0.0.1"/>
  <link href="http://127001.me/index.xml" rel="feed" type="application/rss+xml" title="127.0.0.1"/>

  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-82090130-1', 'auto');
    ga('send', 'pageview');
  </script>
  
</head>

<div class="container">
  <header role="banner">
    <div class="title-block">
      <span class="title-span">
        <a class="title" href="http://127001.me/">
          <span class="user">me</span>@<span class="host">127.0.0.1</span>:<span class="cwd">~</span><span class="prompt">$</span> <span class="cursor">_</span>
        </a>
        
          
        
      </span>
    </div>
  </header>


<main id="single" role="main">
  <div class="post-title-wrapper">
  <div style="display: flex">
    <div style="flex: 1">
<div class="post-category">
  <a href="/category/localhost">/localhost/</a>
</div>

</div>
    <div class="post-date">Sep 17, 2014</div>
  </div>
  <h1>randrctl — profile-based screen manager for X </h1>
  <div style="display: flex">
    <div style="flex: 1">
<div class="post-tags-list">
  
  <a href="/tags/linux">#linux</a>&nbsp;
  
  <a href="/tags/opensource">#opensource</a>&nbsp;
  
  <a href="/tags/randrctl">#randrctl</a>&nbsp;
  
  <a href="/tags/x11">#x11</a>&nbsp;
  
</div>

</div>
  </div>
</div>

  <article>
    <div class="paragraph">
<p>While having some free time, decided to automate one of my daily routines — setting up external display.</p>
</div>
<div class="paragraph">
<p>Idea appeared long before I was told about famous (or not?) <a href="https://github.com/wertarbyte/autorandr">autorandr</a> project.
So if you are familiar with autorandr, you are already familiar with randrctl idea.</p>
</div>
<div class="sect1">
<h2 id="cut">Idea</h2>
<div class="sectionbody">
<div class="paragraph">
<p>How often have you to plug external display to your laptop, how many different setups do you have? I have 3: no external display, office setup, where laptop stands below old 19" external display and home setup, where laptop stands beside of my shiny 23" fullhd display. To set them all up, I created 3 scripts in my home directory: <code>lvds.sh</code>, <code>office.sh</code>, <code>home.sh</code>.</p>
</div>
<div class="paragraph">
<p>That couldn&#8217;t be good. So I decided to develop an utility to manage my screen setup in the same way <a href="https://wiki.archlinux.org/index.php/Netctl">networks are managed in archlinux</a>. So instead of calling custom shell script, it would be possible to do something like</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ randrctl switch-to office</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_randrctl">randrctl</h2>
<div class="sectionbody">
<div class="paragraph">
<p>And here it is: <a href="https://github.com/edio/randrctl" class="bare">https://github.com/edio/randrctl</a>) (tah-dam!). Project has a descriptive readme (I believe[randrctl on github], but here is a brief list of what is done already</p>
</div>
<div class="ulist">
<ul>
<li>
<p>support for display mode (resolution), position, rotation and panning (the latter is not supported in autorandr afaik)</p>
</li>
<li>
<p>switching between profiles</p>
</li>
<li>
<p>executing custom commands before and after the switch or in the case randrctl fails</p>
</li>
<li>
<p>profile creation from current screen setup</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Under the hood it performs calls to <code>xrandr</code> utility to get info about current setup and to apply new settings.</p>
</div>
<div class="sect2">
<h3 id="_installation">Installation</h3>
<div class="paragraph">
<p>Installation instructions are on <a href="https://github.com/edio/randrctl">github</a>. Basic idea is that you clone a git repo and allow python to install the module. And then you copy exemplary configs to specific locations and copy completion functions for bash and zsh if you need them.</p>
</div>
<div class="paragraph">
<p>For archers there is a <a href="https://aur.archlinux.org/packages/randrctl-git">package on AUR</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration">Configuration</h3>
<div class="paragraph">
<p>All configuration is currently stored under <code>/etc/randrctl/</code> (which may be not such a good idea, because screen setup usually do not require root privileges, I know. I&#8217;m working on it).</p>
</div>
<div class="paragraph">
<p><code>/etc/randrctl/config.ini</code> allows to declare custom commands on profile switch or failure. The whole property value gets executed in a shell, so all these <code>&amp;&amp;`s, `||`s, pipes and redirections are supported. While composing your custom commands, you can get profile name from `$randr_profile</code> environment variable. Error, if it happens, is stored to <code>$randr_error</code>.</p>
</div>
<div class="paragraph">
<p>Profiles are stored under <code>/etc/randrctl/profiles/</code> as plain text files in json format. Profile structure and property names are self-descriptive, I believe:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "outputs": {
        "LVDS1": {
            "mode": "1366x768",
            "panning": "1366x1080"
        },
        "DP1": {
            "mode": "1920x1080",
            "pos": "1366x0".
            "rotate": "inverted"
        }
    },
    "primary": "DP1"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_usage">Usage</h3>
<div class="paragraph">
<p>Running <code>randrctl</code> without parameters (or with canonical <code>-h</code> or <code>--help</code>) will tell you all you can do with it. And you can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>check your current screen setup</p>
<div class="paragraph">
<p><code>$ randrctl show</code></p>
</div>
</li>
<li>
<p>dump it to file (note that root is required here)</p>
<div class="paragraph">
<p><code># randrctl dump my_setup</code></p>
</div>
</li>
<li>
<p>check stored profiles</p>
<div class="paragraph">
<p><code>$ randrctl show my_setup</code></p>
</div>
</li>
<li>
<p>list your profiles</p>
<div class="paragraph">
<p><code>$ randrctl list</code></p>
</div>
</li>
<li>
<p>and finally, apply profile settings</p>
<div class="paragraph">
<p><code>$ randrctl switch-to my_setup</code></p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_planned_features">Planned features</h3>
<div class="paragraph">
<p>Right now I&#8217;m thinking about 2 things:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>autodetecting when display is plugged via udev and applying profile, that matches display EDID (I come with this idea before knowing about autorandr, I swear ;))</p>
</li>
<li>
<p>support for user profiles and configurations. This will allow to run randrctl without root</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Of course there is always a room for code and experience improvements, so these will take place also.</p>
</div>
</div>
</div>
</div>
  </article>
</main>



<article class="comments">
    <div id="disqus_thread"></div>
    <script>
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) !== -1) {
          document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
        } else {
          var disqus_config = function () {
              
          };
          (function() {
              var inIFrame = function() {
                  var iframe = true;
                  try { iframe = window.self !== window.top; } catch (e) {}
                  return iframe;
              };
              if (inIFrame()) return;
              var disqus_js = '//127001me.disqus.com/embed.js';
              var d = document, s = d.createElement('script');
              s.src = disqus_js; s.async = true;
              s.setAttribute('data-timestamp', +new Date());
              var b = false, l = function() {
                  if (b) return;
                  (d.head || d.body).appendChild(s); b = true;
              }
              var t = d.getElementById('disqus_thread');
              s.onerror = function(e) {
                  if (sessionStorage.getItem('failure-note')) return;
                  t.innerText = 'Disqus failed to load';
                  t.style.border = '1px dashed';
                  t.style.padding = '.5em';
                  t.style.background = 'lightyellow';
                  sessionStorage.setItem('failure-note', true);
              };
              
              if (location.hash.match(/^#comment/)) return l();
              var c = function() {
                  if (b) return;
                  var rect = t.getBoundingClientRect();
                  if (rect.top < window.innerHeight && rect.bottom >= 0) l();
              };
              window.addEventListener('load', c);
              d.addEventListener('scroll', c);
          })();
        }
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</article>


<footer role="contentinfo">
  <div class="footer-content">
    
    <div class="footer-copyright-info">
      © 2016 Dmytro Kostiuchenko
    </div>
    

    <div class="footer-social-buttons">
      
      <a href="https://github.com/edio" title="GitHub"><i class="fa fa-github"></i></a>
      
      
      <a href="https://ua.linkedin.com/in/dmytro-kostiuchenko-7b046b14" title="Linkedin"><i class="fa fa-linkedin-square"></i></a>
      
      
      
      
    </div>
  </div>
</footer>
</div>

<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>


